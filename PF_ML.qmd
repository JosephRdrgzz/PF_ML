---
title: "PF_ML"
format: pdf
editor: visual
---

## Entendimiento del negocio

### a. ¬øPor qu√© se implement√≥ el etiquetado frontal?

El Gobierno de M√©xico implement√≥ el etiquetado frontal de advertencia en alimentos y bebidas en respuesta a una **grave crisis de salud p√∫blica** causada por las alt√≠simas tasas de obesidad y enfermedades cr√≥nicas ligadas a la mala alimentaci√≥n. M√©xico se hab√≠a posicionado como l√≠der mundial en obesidad infantil y segundo lugar en obesidad de adolescentes y adultos, lo que deriv√≥ en un incremento dram√°tico de padecimientos como la diabetes. Tan solo en la √∫ltima d√©cada, las muertes por diabetes alcanzaron niveles alarmantes. Frente a esta emergencia, el gobierno impuls√≥ la modificaci√≥n de la Norma Oficial NOM-051 para introducir un nuevo etiquetado frontal con sellos de advertencia. Este etiquetado entr√≥ en vigor el **1 de octubre de 2020** y busca informar de forma clara y visible sobre el exceso de az√∫cares, sodio, grasas y calor√≠as en productos procesados, de modo que los consumidores puedan tomar decisiones m√°s saludables.

### b. Diccionario de variables

| Variable | Tipo | Valores / Rango | Unidades | Definici√≥n |
|---------------|---------------|---------------|---------------|---------------|
| P1 | Categ√≥rica ordinal | 1-7, 9 | Calor√≠as | Estima cu√°ntas calor√≠as diarias debe ingerir una persona similar |
| P3 | Categ√≥rica nominal | 1=S√≠, 2=No, 9=NS/NR | ‚Äî | Conocimiento de la existencia de info nutrimental |
| P4 | Categ√≥rica nominal | 1=S√≠, 2=No, 9=NS/NR | ‚Äî | Si lee o no la informaci√≥n nutrimental |
| P7 | Categ√≥rica ordinal | 1 a 5, 9 | ‚Äî | Frecuencia con la que elige productos por informaci√≥n del empaque |
| Edad | Num√©rica continua | 20‚Äì112 | A√±os | Edad del entrevistado |
| Sexo | Categ√≥rica nominal | 1=Hombre, 2=Mujer | ‚Äî | Sexo del entrevistado |
| Entidad federativa | Categ√≥rica | 1‚Äì32 | ‚Äî | Estado de residencia |
| Dominio | Categ√≥rica | 1=Urbano, 2=Rural | ‚Äî | Tipo de localidad |
| Regi√≥n | Categ√≥rica | 1=Norte, 2=Centro, 3=CDMX, 4=Sur | ‚Äî | Zona geogr√°fica |
| Estrato | Categ√≥rica | 1‚Äì4 | ‚Äî | Nivel socioecon√≥mico |
| Estrato de dise√±o | Texto | ID | ‚Äî | Identificador geogr√°fico de estrato muestral |
| UPM de dise√±o | Texto | ID | ‚Äî | Unidad Primaria de Muestreo |

> üí° Los valores "9" en preguntas P1, P3, P4, y P7 representan "No sabe / No responde" y se tratan como NA.

------------------------------------------------------------------------

### c. Problemas de clasificaci√≥n

#### i. Problema 1

**Objetivo:** Predecir si una persona **NO** lee la informaci√≥n nutrimental (P4).

-   Variable dependiente: `P4` ‚àà Œ©‚ÇÄ = {NO, SI}
-   Valor de inter√©s: "NO"
-   Predictoras: `P1`, `P3`, `Edad`, `Sexo`, `Entidad federativa`, `Dominio`, `Regi√≥n`, `Estrato sociodemogr√°fico`

#### ii. Problema 2

**Objetivo:** Predecir la **frecuencia** con que una persona elige productos por informaci√≥n del empaque (`P7`, valores ordinales del 1 al 5).

-   Variable dependiente: `P7`
-   Predictoras: mismas que en problema 1, pero **no se usa P4**

------------------------------------------------------------------------

### d. Lectura y preparaci√≥n de los datos

```{r}
prob1 <- read.csv("datosTF.csv", header = TRUE)
```

i\. Crear 2 subconjuntos de datos, uno por problema.

```{r}
prob1 <- read.csv("datosTF.csv", header = TRUE)
```

```{r}
prob2 <- read.csv("datosTF.csv", header = TRUE)
```

ii\. Eliminar los renglones con NA y de las personas que no saben o no respondieron (c√≥digo 9).

```{r}
nrow(prob1)  # antes
#quitar los NA haciendo que los 9 se conviertan en NA
prob1$P4[prob1$P4 == 9] <- NA
#quitanto na
prob1 <- na.omit(prob1)
nrow(prob1)  # despues
```

```{r}
nrow(prob2)  # antes
#parar 9s a na
prob2$P7[prob2$P7 == 9] <- NA
#pasamos a factor ordinal
prob2 <- na.omit(prob2)
nrow(prob2)  # despues
```

iii\. Sustituir en la variable dependiente el valor num√©rico por su significado (c√≥digo).

```{r}
#para p1
# Convertir P4 num√©rico a "SI"/"NO"
prob1$P4 <- ifelse(prob1$P4 == 1, "SI", "NO")
prob1$P4 <- factor(prob1$P4, levels = c("NO","SI"))
```

```{r}
#para p2
prob2$P7 <- factor(prob2$P7, 
                   levels = 1:5,
                   labels = c("Nunca", "Casi nunca", "A veces", 
                              "Casi siempre", "Siempre"),
                   ordered = TRUE)
```

iv\. Reportar el n√∫mero de renglones que qued√≥ en cada uno.

```{r}
# Contar renglones en cada conjunto
nrow(prob1)  # N√∫mero de renglones en problema 1
nrow(prob2)  # N√∫mero de renglones en problema 
```

Problema 1.

2\. Entendimiento de los datos

An√°lisis estad√≠stico de los rasgos del vector de caracter√≠sticas (apoyarse de gr√°ficos, de tama√±o apropiado)

a\. N√∫mero de datos faltantes por columna.

```{r}
#carga de datos
library(tidyverse)
problema1 <- read.csv("datosTF.csv", header = TRUE)
glimpse(problema1)   # estructura y tipos de datos
```

b\. An√°lisis univariado.

```{r}
#  Contar y mostrar NAs por columna
na_por_col <- colSums(is.na(problema1))
print(na_por_col)
```

```{r}
barplot(na_por_col,
        las   = 2,                          
        ylim  = c(0, 15000))
```

c\. An√°lisis de correlaci√≥n.

```{r}

# Cargar datos
datos <- read.csv("datosTF.csv", header = TRUE)

# Paso 1: Crear variable binaria para P4 (1 = SI, 0 = NO, NA = no responde)
datos$P4_bin <- ifelse(datos$P4 == 1, 1,
                       ifelse(datos$P4 == 2, 0, NA))

# Paso 2: Eliminar filas donde P4_bin es NA
df_filtrado <- datos[!is.na(datos$P4_bin), ]

# Paso 3: Seleccionar variables num√©ricas incluyendo P3 y excluyendo P7
vars_numericas <- df_filtrado %>%
  select(P1, P3, EDAD, SEXO, ENT, DOMINIO, REGION, EST_DIS, UPM_DIS, ESTRATO)

# Paso 4: Calcular correlaciones con P4_bin
correlaciones <- cor(df_filtrado$P4_bin, vars_numericas)

# Paso 5: Asignar nombres legibles
nombres_legibles <- c(
  "P1 (calor√≠as)", 
  "P3 (conoce info)", 
  "Edad", 
  "Sexo", 
  "Entidad", 
  "Dominio", 
  "Regi√≥n", 
  "Estrato dise√±o", 
  "UPM dise√±o", 
  "Estrato socioecon√≥mico"
)

# Asegurarse que los nombres coincidan
names(correlaciones) <- nombres_legibles

# Paso 6: Ordenar y mostrar
correlaciones_ordenadas <- sort(correlaciones, decreasing = TRUE)
correlaciones_ordenadas
```

d\. Realizar una comparaci√≥n de la distribuci√≥n de cada una de las variables con respecto a la variable de inter√©s.

```{r}
# Cargar librer√≠as
library(tidyverse)

# Cargar datos limpios
prob1 <- read.csv("datosTF.csv", header = TRUE)
prob1$P4 <- ifelse(prob1$P4 == 1, "SI", "NO")
prob1$P4 <- factor(prob1$P4, levels = c("NO", "SI"))

str(prob1)

# ----------- Edad
ggplot(prob1, aes(x = P4, y = EDAD, fill = P4)) +
  geom_boxplot() +
  labs(title = "Distribuci√≥n de Edad por respuesta en P4",
       x = "¬øLee informaci√≥n nutrimental?",
       y = "Edad") +
  scale_fill_manual(values = c("NO" = "purple", "SI" = "forestgreen")) +
  theme_minimal()


# ----------- P1, calor√≠as estimadas
ggplot(prob1, aes(x = as.factor(P1), fill = P4)) +
  geom_bar(position = "fill") +
  labs(title = "Distribuci√≥n de P1 (calor√≠as) por respuesta en P4",
       x = "Categor√≠a de calor√≠as estimadas",
       y = "Proporci√≥n",
       fill = "P4") +
  theme_minimal()


# ----------- P3, tabla nutrimental
ggplot(prob1, aes(x = as.factor(P3), fill = P4)) +
  geom_bar(position = "fill") +
  labs(title = "Conocimiento de info nutrimental (P3) por P4",
       x = "P3: ¬øConoce info nutrimental?",
       y = "Proporci√≥n",
       fill = "P4") +
  theme_minimal()


# ----------- Sexo
ggplot(prob1, aes(x = as.factor(SEXO), fill = P4)) +
  geom_bar(position = "fill") +
  labs(title = "Distribuci√≥n de Sexo por respuesta en P4",
       x = "Sexo (1 = Hombre, 2 = Mujer)",
       y = "Proporci√≥n",
       fill = "P4") +
  theme_minimal()



# ----------- Regi√≥n
ggplot(prob1, aes(x = as.factor(REGION), fill = P4)) +
  geom_bar(position = "fill") +
  labs(title = "Distribuci√≥n por Regi√≥n geogr√°fica y lectura P4",
       x = "Regi√≥n (1 = Norte, ..., 4 = Sur)",
       y = "Proporci√≥n",
       fill = "P4") +
  theme_minimal()



# ----------- Dominio 
ggplot(prob1, aes(x = as.factor(DOMINIO), fill = P4)) +
  geom_bar(position = "fill") +
  labs(title = "Distribuci√≥n de zona (Dominio) por P4",
       x = "Dominio (1 = Urbano, 2 = Rural)",
       y = "Proporci√≥n",
       fill = "P4") +
  theme_minimal()




# ----------- Estrato sociodemogr√°fico
ggplot(prob1, aes(x = as.factor(ESTRATO), fill = P4)) +
  geom_bar(position = "fill") +
  labs(title = "Distribuci√≥n por nivel socioecon√≥mico (Estrato) y P4",
       x = "Estrato (1 = Bajo ... 4 = Alto)",
       y = "Proporci√≥n",
       fill = "P4") +
  theme_minimal()
```

e\. Otros an√°lisis bivariados y/o multivariados.

f\. Escribir los hallazgos e informaci√≥n √∫til de este paso

-   **Edad** muestra una distribuci√≥n distinta entre quienes leen y quienes no leen la informaci√≥n nutrimental. El gr√°fico de boxplot indica que las personas que **no leen tienden a ser ligeramente mayores**. Aunque la correlaci√≥n es baja (r = -0.038), el patr√≥n visual respalda esta diferencia.

-   En **P1** (percepci√≥n de calor√≠as que se deben consumir), se observ√≥ una **asociaci√≥n importante con P4**. Aquellos que **no leen** las etiquetas se distribuyen de forma distinta entre las categor√≠as cal√≥ricas, siendo m√°s frecuentes en los extremos. Esta variable present√≥ la correlaci√≥n **m√°s fuerte con la variable objetivo** (r = -0.193), por lo que es una **predictora √∫til para modelado**.

-   En el caso de **P3**, la variable mostr√≥ **desviaci√≥n est√°ndar cero** al realizar la limpieza de datos, por lo que fue imposible calcular su correlaci√≥n. Esto se debe a que, l√≥gicamente, **si una persona responde ‚Äús√≠‚Äù en P4 (que lee la informaci√≥n), necesariamente debe haber respondido ‚Äús√≠‚Äù en P3 (que sabe que existe dicha informaci√≥n)**. Por esta raz√≥n, la variable **P3 est√° impl√≠citamente contenida en P4**, y su inclusi√≥n no aporta valor explicativo adicional. **Pensamos eliminarla del modelo para evitar redundancia.**

-   Las variables **Sexo**, **Regi√≥n**, **Dominio (zona urbana/rural)** y **Estrato socioecon√≥mico** muestran patrones visuales diferenciables en las proporciones de lectura (P4), aunque sus **correlaciones individuales fueron bajas** (todas menores a r = ¬±0.06). Sin embargo, se sugiere conservarlas en el modelado, ya que podr√≠an tener **efectos combinados o no lineales**, √∫tiles en algoritmos como √°rboles de decisi√≥n.

-   Finalmente, variables t√©cnicas como **Entidad federativa (ENT)**, **UPM de dise√±o** y **Estrato de dise√±o** presentaron correlaciones cercanas a cero. Aunque pueden ser √∫tiles para an√°lisis exploratorio o ajustes de dise√±o muestral, **se sugiere descartarlas para el modelado predictivo** si no se justifica su aporte explicativo.
